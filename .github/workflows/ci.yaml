# This is a basic workflow to help you get started with Actions

name: CI

on:
  push:     
  workflow_dispatch:
    inputs:
      image:
        description: Image to scan
        required: true
        default: alpine:3.7

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      #- name: Scan image
      #  id: scan
      #  uses: sysdiglabs/scan-action@v3
      #  with:
      #    image-tag: "alpine:3.7"
      #    sysdig-secure-token: ${{ secrets.SYSDIG_SECURE_TOKEN }}
      #    ignore-failed-scan: true

      #- uses: github/codeql-action/upload-sarif@v1
      #  if: always()
      #  with:
      #    sarif_file: ${{ steps.scan.outputs.sarifReport }}
      
      - name: Build the Docker image
        run: |
          echo "FROM alpine:3.7" > Dockerfile
          docker build . --file Dockerfile --tag local:latest

      - name: Scan local image
        id: scan-local
        uses: sysdiglabs/scan-action@v3
        with:
          image-tag: "local:latest"
          sysdig-secure-token: ${{ secrets.SYSDIG_SECURE_TOKEN }}
          ignore-failed-scan: true
          input-type: docker-daemon
          run-as-user: root

      - uses: github/codeql-action/upload-sarif@v1
        if: always()
        with:
          sarif_file: ${{ steps.scan-local.outputs.sarifReport }}

